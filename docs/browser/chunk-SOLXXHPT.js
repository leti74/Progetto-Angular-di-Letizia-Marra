import{a as U,d as q,e as $,f as z}from"./chunk-4WFLFYZM.js";import{b as K}from"./chunk-JUGJOMLV.js";import{i as H,j as J}from"./chunk-UDETO42H.js";import{Ac as D,Cc as v,Dc as x,Ec as _,Fa as u,Gc as p,Hc as b,Ic as h,Jc as P,Kc as G,Lc as k,Mc as L,Nc as C,Ob as E,Qa as F,Qc as R,Ra as S,Rc as O,Sa as w,Sc as j,Ta as N,Ua as l,Va as s,Wa as o,Wc as V,Xa as m,Xc as B,cb as c,db as M,ob as n,ra as a,sc as T,vc as A,wc as I,za as d,zc as g}from"./chunk-T5GEWLYA.js";var y=class i{constructor(e){this.dialogRef=e;this.postForm=new _({title:new p("",D.required),body:new p("",D.required)})}postForm;cancel(){this.dialogRef.close()}save(){let e=this.postForm.value.title,t=this.postForm.value.body;this.postForm.valid&&this.dialogRef.close({title:e,body:t})}static \u0275fac=function(t){return new(t||i)(d($))};static \u0275cmp=u({type:i,selectors:[["app-add-poss-dialog"]],decls:16,vars:2,consts:[["mat-dialog-title","",1,"p-4"],[1,"flex","flex-col","gap-3","p-4",3,"formGroup"],["matInput","","formControlName","title","placeholder","Post title"],["matInput","","rows","4","formControlName","body","placeholder","Post content"],[1,"flex","justify-end","gap-2","mt-3"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(t,r){t&1&&(s(0,"h2",0),n(1,"Add new post"),o(),s(2,"form",1)(3,"mat-form-field")(4,"mat-label"),n(5,"Title"),o(),m(6,"input",2),o(),s(7,"mat-form-field")(8,"mat-label"),n(9,"Body"),o(),m(10,"textarea",3),o(),s(11,"div",4)(12,"button",5),c("click",function(){return r.cancel()}),n(13,"Cancel"),o(),s(14,"button",6),c("click",function(){return r.save()}),n(15," Save "),o()()()),t&2&&(a(2),l("formGroup",r.postForm),a(12),l("disabled",r.postForm.invalid))},dependencies:[C,b,g,v,x,h,P,I,A,T,q,O,R,E,B,V],encapsulation:2})};var tt=(i,e)=>e.id;function et(i,e){i&1&&(s(0,"div",8),m(1,"mat-progress-spinner",10),o())}function ot(i,e){if(i&1&&m(0,"app-post-item",12),i&2){let t=e.$implicit;l("post",t)}}function it(i,e){if(i&1&&w(0,ot,1,1,"app-post-item",12,tt),i&2){let t=M(2);N(t.posts)}}function st(i,e){i&1&&(s(0,"p",11),n(1,"No Posts published"),o())}function rt(i,e){if(i&1&&(s(0,"div",9),F(1,it,2,0)(2,st,2,0,"p",11),o()),i&2){let t=M();a(),S(t.posts.length>0?1:2)}}var Q=class i{constructor(e,t){this.usersService=e;this.dialog=t}posts=[];allPosts=[];postsForm;isLoading=!1;ngOnInit(){this.postsForm=new _({searchText:new p(""),forPage:new p(10)}),this.loadPosts(),this.postsForm.valueChanges.subscribe(()=>{this.applyFilters()})}loadPosts(){this.isLoading=!0,this.usersService.getAllPosts().subscribe({next:e=>{this.posts=e,this.allPosts=e;let t=0;e.length===0&&(this.isLoading=!1),this.posts.forEach(r=>{this.usersService.getCommentsByPost(r.id).subscribe(f=>{r.comments=f,t++,t===this.posts.length&&(this.applyFilters(),this.isLoading=!1)})})},error:e=>{console.error(e),this.isLoading=!1}})}applyFilters(){let e=this.postsForm.value.searchText?.toLowerCase()||"",t=this.postsForm.value.forPage;this.posts=this.allPosts.filter(r=>r.title.toLowerCase().includes(e)||r.body.toLowerCase().includes(e)).slice(0,t)}addPost(){this.dialog.open(y,{width:"400px"}).afterClosed().subscribe(t=>{t&&this.usersService.addNewPost(t).subscribe(()=>{this.loadPosts()})})}static \u0275fac=function(t){return new(t||i)(d(j),d(z))};static \u0275cmp=u({type:i,selectors:[["app-posts"]],decls:22,vars:6,consts:[[1,"posts-page"],[1,"flex","flex-col","mt-10"],[1,"flex","flex-wrap","gap-3","items-center","px-8","mb-10","w-full","md:w-auto","md:max-w-4xl","mx-auto",3,"formGroup"],[1,"flex","flex-col","gap-2","w-full","sm:w-auto"],["type","text","formControlName","searchText","placeholder","Title or body",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","outline-0"],["formControlName","forPage",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","outline-0"],[3,"value"],["label","Add Post","icon","note-add",1,"mt-5",3,"btnClick"],[1,"flex","justify-center","mt-30"],[1,"flex","flex-col","items-stretch","md:items-center","mt-14","gap-10","px-5","sm:px-0"],["mode","indeterminate","diameter","40"],[1,"text-center","text-gray-500","mt-10"],[3,"post"]],template:function(t,r){t&1&&(s(0,"div",0)(1,"div",1)(2,"form",2)(3,"div",3)(4,"label"),n(5,"Search post"),o(),m(6,"input",4),o(),s(7,"div",3)(8,"label"),n(9,"Posts per page"),o(),s(10,"select",5)(11,"option",6),n(12,"5"),o(),s(13,"option",6),n(14,"10"),o(),s(15,"option",6),n(16,"25"),o(),s(17,"option",6),n(18,"50"),o()()(),s(19,"app-button",7),c("btnClick",function(){return r.addPost()}),o()(),F(20,et,2,0,"div",8)(21,rt,3,1,"div",9),o()()),t&2&&(a(2),l("formGroup",r.postsForm),a(9),l("value",5),a(2),l("value",10),a(2),l("value",25),a(2),l("value",50),a(3),S(r.isLoading?20:21))},dependencies:[K,C,b,k,L,g,G,v,x,h,P,U,J,H],styles:[".posts-page[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;color:#374151;font-weight:500}.posts-page[_ngcontent-%COMP%]{padding-top:2.3rem}"]})};export{Q as Posts};
