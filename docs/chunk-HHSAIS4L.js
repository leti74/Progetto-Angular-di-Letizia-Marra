import{a as U,d as q,e as $,f as z}from"./chunk-4WFLFYZM.js";import{b as K}from"./chunk-JNCN7HD3.js";import{i as H,j as J}from"./chunk-UDETO42H.js";import{Ac as D,Cc as v,Dc as x,Ec as b,Fa as u,Gc as p,Hc as _,Ic as P,Jc as h,Kc as G,Lc as k,Mc as L,Nc as C,Ob as w,Qa as F,Qc as R,Ra as S,Rc as O,Sa as N,Sc as j,Ta as E,Ua as l,Va as r,Wa as o,Wc as V,Xa as m,Xc as B,cb as c,db as M,ob as n,ra as a,sc as T,vc as A,wc as I,za as d,zc as g}from"./chunk-T5GEWLYA.js";var y=class i{constructor(e){this.dialogRef=e;this.postForm=new b({title:new p("",D.required),body:new p("",D.required)})}postForm;cancel(){this.dialogRef.close()}save(){let e=this.postForm.value.title,t=this.postForm.value.body;this.postForm.valid&&this.dialogRef.close({title:e,body:t})}static \u0275fac=function(t){return new(t||i)(d($))};static \u0275cmp=u({type:i,selectors:[["app-add-poss-dialog"]],decls:16,vars:2,consts:[["mat-dialog-title","",1,"p-4"],[1,"flex","flex-col","gap-3","p-4",3,"formGroup"],["matInput","","formControlName","title","placeholder","Post title"],["matInput","","rows","4","formControlName","body","placeholder","Post content"],[1,"flex","justify-end","gap-2","mt-3"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"]],template:function(t,s){t&1&&(r(0,"h2",0),n(1,"Add new post"),o(),r(2,"form",1)(3,"mat-form-field")(4,"mat-label"),n(5,"Title"),o(),m(6,"input",2),o(),r(7,"mat-form-field")(8,"mat-label"),n(9,"Body"),o(),m(10,"textarea",3),o(),r(11,"div",4)(12,"button",5),c("click",function(){return s.cancel()}),n(13,"Cancel"),o(),r(14,"button",6),c("click",function(){return s.save()}),n(15," Save "),o()()()),t&2&&(a(2),l("formGroup",s.postForm),a(12),l("disabled",s.postForm.invalid))},dependencies:[C,_,g,v,x,P,h,I,A,T,q,O,R,w,B,V],encapsulation:2})};var tt=(i,e)=>e.id;function et(i,e){i&1&&(r(0,"div",8),m(1,"mat-progress-spinner",10),o())}function ot(i,e){if(i&1&&m(0,"app-post-item",12),i&2){let t=e.$implicit;l("post",t)}}function it(i,e){if(i&1&&N(0,ot,1,1,"app-post-item",12,tt),i&2){let t=M(2);E(t.posts)}}function rt(i,e){i&1&&(r(0,"p",11),n(1,"No Posts published"),o())}function st(i,e){if(i&1&&(r(0,"div",9),F(1,it,2,0)(2,rt,2,0,"p",11),o()),i&2){let t=M();a(),S(t.posts.length>0?1:2)}}var Q=class i{constructor(e,t){this.usersService=e;this.dialog=t}posts=[];allPosts=[];postsForm;isLoading=!1;ngOnInit(){this.postsForm=new b({searchText:new p(""),forPage:new p(10)}),this.loadPosts(),this.postsForm.valueChanges.subscribe(()=>{this.applyFilters()})}loadPosts(){this.isLoading=!0,this.usersService.getAllPosts().subscribe({next:e=>{this.posts=e,this.allPosts=e;let t=0;e.length===0&&(this.isLoading=!1),this.posts.forEach(s=>{this.usersService.getCommentsByPost(s.id).subscribe(f=>{s.comments=f,t++,t===this.posts.length&&(this.applyFilters(),this.isLoading=!1)})})},error:e=>{console.error(e),this.isLoading=!1}})}applyFilters(){let e=this.postsForm.value.searchText?.toLowerCase()||"",t=this.postsForm.value.forPage;this.posts=this.allPosts.filter(s=>s.title.toLowerCase().includes(e)||s.body.toLowerCase().includes(e)).slice(0,t)}addPost(){this.dialog.open(y,{width:"400px"}).afterClosed().subscribe(t=>{t&&this.usersService.addNewPost(t).subscribe(()=>{this.loadPosts()})})}static \u0275fac=function(t){return new(t||i)(d(j),d(z))};static \u0275cmp=u({type:i,selectors:[["app-posts"]],decls:23,vars:6,consts:[[1,"posts-page"],[1,"flex!","flex-wrap!","flex-row!","gap-3!","items-center!","pr-10!","pl-7!","mb-10!",3,"formGroup"],[1,"flex","flex-col","gap-2"],["type","text","formControlName","searchText","placeholder","Title or body",1,"px-4!","py-2!","border!","border-gray-300!","rounded-lg!","outline-0"],["formControlName","forPage",1,"px-4!","py-2!","border!","border-gray-300!","rounded-lg!","outline-0"],[3,"value"],[1,"flex","flex-row","gap-3"],["label","Add Post","icon","note-add",1,"button","mt-7",3,"btnClick"],[1,"flex","justify-center","mt-10"],[1,"flex","flex-col","mt-7","gap-10","px-3"],["mode","indeterminate","diameter","40"],[1,"text-center","text-gray-500","mt-10"],[3,"post"]],template:function(t,s){t&1&&(r(0,"div",0)(1,"div")(2,"form",1)(3,"div",2)(4,"label"),n(5,"Search post"),o(),m(6,"input",3),o(),r(7,"div",2)(8,"label"),n(9,"Posts per page"),o(),r(10,"select",4)(11,"option",5),n(12,"5"),o(),r(13,"option",5),n(14,"10"),o(),r(15,"option",5),n(16,"25"),o(),r(17,"option",5),n(18,"50"),o()()(),r(19,"div",6)(20,"app-button",7),c("btnClick",function(){return s.addPost()}),o()()(),F(21,et,2,0,"div",8)(22,st,3,1,"div",9),o()()),t&2&&(a(2),l("formGroup",s.postsForm),a(9),l("value",5),a(2),l("value",10),a(2),l("value",25),a(2),l("value",50),a(4),S(s.isLoading?21:22))},dependencies:[K,C,_,k,L,g,G,v,x,P,h,U,J,H],styles:[".posts-page[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;color:#374151;font-weight:500}.posts-page[_ngcontent-%COMP%]{padding:2.3rem 1.5rem 1.5rem;display:flex;flex-direction:column;gap:1rem}"]})};export{Q as Posts};
